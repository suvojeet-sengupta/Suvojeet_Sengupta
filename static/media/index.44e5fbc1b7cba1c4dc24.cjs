"use strict";const compileMessage=require("@lingui/message-utils/compileMessage"),isString=e=>"string"===typeof e,isFunction=e=>"function"===typeof e,cache=new Map,defaultLocale="en";function normalizeLocales(e){return[...Array.isArray(e)?e:[e],"en"]}function date(e,t,s){const a=normalizeLocales(e);let i;if(s||(s="default"),"string"===typeof s)switch(i={day:"numeric",month:"short",year:"numeric"},s){case"full":i.weekday="long";case"long":i.month="long";break;case"short":i.month="numeric"}else i=s;return getMemoized(()=>cacheKey("date",a,s),()=>new Intl.DateTimeFormat(a,i)).format(isString(t)?new Date(t):t)}function time(e,t,s){let a;if(s||(s="default"),"string"===typeof s)switch(a={second:"numeric",minute:"numeric",hour:"numeric"},s){case"full":case"long":a.timeZoneName="short";break;case"short":delete a.second}else a=s;return date(e,t,a)}function number(e,t,s){const a=normalizeLocales(e);return getMemoized(()=>cacheKey("number",a,s),()=>new Intl.NumberFormat(a,s)).format(t)}function plural(e,t,s,{offset:a=0,...i}){const l=normalizeLocales(e),n=t?getMemoized(()=>cacheKey("plural-ordinal",l),()=>new Intl.PluralRules(l,{type:"ordinal"})):getMemoized(()=>cacheKey("plural-cardinal",l),()=>new Intl.PluralRules(l,{type:"cardinal"}));return i[s]??i[n.select(s-a)]??i.other}function getMemoized(e,t){const s=e();let a=cache.get(s);return a||(a=t(),cache.set(s,a)),a}function cacheKey(e,t,s){return`${e}-${t.join("-")}-${JSON.stringify(s)}`}const formats={__proto__:null,date:date,defaultLocale:"en",number:number,plural:plural,time:time},ESCAPE_SEQUENCE_REGEX=/\\u[a-fA-F0-9]{4}|\\x[a-fA-F0-9]{2}/,decodeEscapeSequences=e=>e.replace(/\\u([a-fA-F0-9]{4})|\\x([a-fA-F0-9]{2})/g,(e,t,s)=>{if(t){const e=parseInt(t,16);return String.fromCharCode(e)}{const e=parseInt(s,16);return String.fromCharCode(e)}}),OCTOTHORPE_PH="%__lingui_octothorpe__%",getDefaultFormats=(e,t,s={})=>{const a=t||e,i=e=>"object"===typeof e?e:s[e],l=(e,t)=>{const l=Object.keys(s).length?i("number"):void 0,n=number(a,e,l);return t.replace(new RegExp(OCTOTHORPE_PH,"g"),n)};return{plural:(e,t)=>{const{offset:s=0}=t,i=plural(a,!1,e,t);return l(e-s,i)},selectordinal:(e,t)=>{const{offset:s=0}=t,i=plural(a,!0,e,t);return l(e-s,i)},select:selectFormatter,number:(e,t)=>number(a,e,i(t)||{style:t}),date:(e,t)=>date(a,e,i(t)||t),time:(e,t)=>time(a,e,i(t)||t)}},selectFormatter=(e,t)=>t[e]??t.other;function interpolate(e,t,s){return(a={},i)=>{const l=getDefaultFormats(t,s,i),n=(e,t=!1)=>Array.isArray(e)?e.reduce((e,s)=>{if("#"===s&&t)return e+OCTOTHORPE_PH;if(isString(s))return e+s;const[i,o,r]=s;let c,u={};if("plural"===o||"selectordinal"===o||"select"===o?Object.entries(r).forEach(([e,t])=>{u[e]=n(t,"plural"===o||"selectordinal"===o)}):u=r,o){c=(0,l[o])(a[i],u)}else c=a[i];return null==c?e:e+c},""):e,o=n(e);return isString(o)&&ESCAPE_SEQUENCE_REGEX.test(o)?decodeEscapeSequences(o):isString(o)?o:o?String(o):""}}var __defProp$1=Object.defineProperty,__defNormalProp$1=(e,t,s)=>t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,__publicField$1=(e,t,s)=>(__defNormalProp$1(e,"symbol"!==typeof t?t+"":t,s),s);class EventEmitter{constructor(){__publicField$1(this,"_events",{})}on(e,t){var s;return(s=this._events)[e]??(s[e]=[]),this._events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){const s=this._getListeners(e);if(!s)return;const a=s.indexOf(t);~a&&s.splice(a,1)}emit(e,...t){const s=this._getListeners(e);s&&s.map(e=>e.apply(this,t))}_getListeners(e){const t=this._events[e];return!!Array.isArray(t)&&t}}var __defProp=Object.defineProperty,__defNormalProp=(e,t,s)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,__publicField=(e,t,s)=>(__defNormalProp(e,"symbol"!==typeof t?t+"":t,s),s);class I18n extends EventEmitter{constructor(e){super(),__publicField(this,"_locale",""),__publicField(this,"_locales"),__publicField(this,"_localeData",{}),__publicField(this,"_messages",{}),__publicField(this,"_missing"),__publicField(this,"_messageCompiler"),__publicField(this,"t",this._.bind(this)),"production"!==process.env.NODE_ENV&&this.setMessagesCompiler(compileMessage.compileMessage),null!=e.missing&&(this._missing=e.missing),null!=e.messages&&this.load(e.messages),null!=e.localeData&&this.loadLocaleData(e.localeData),("string"===typeof e.locale||e.locales)&&this.activate(e.locale??"en",e.locales)}get locale(){return this._locale}get locales(){return this._locales}get messages(){return this._messages[this._locale]??{}}get localeData(){return this._localeData[this._locale]??{}}_loadLocaleData(e,t){const s=this._localeData[e];s?Object.assign(s,t):this._localeData[e]=t}setMessagesCompiler(e){return this._messageCompiler=e,this}loadLocaleData(e,t){"string"===typeof e?this._loadLocaleData(e,t):Object.keys(e).forEach(t=>this._loadLocaleData(t,e[t])),this.emit("change")}_load(e,t){const s=this._messages[e];s?Object.assign(s,t):this._messages[e]=t}load(e,t){"string"==typeof e&&"object"===typeof t?this._load(e,t):Object.entries(e).forEach(([e,t])=>this._load(e,t)),this.emit("change")}loadAndActivate({locale:e,locales:t,messages:s}){this._locale=e,this._locales=t||void 0,this._messages[this._locale]=s,this.emit("change")}activate(e,t){"production"!==process.env.NODE_ENV&&(this._messages[e]||console.warn(`Messages for locale "${e}" not loaded.`)),this._locale=e,this._locales=t,this.emit("change")}_(e,t,s){if(!this.locale)throw new Error("Lingui: Attempted to call a translation function without setting a locale.\nMake sure to call `i18n.activate(locale)` before using Lingui functions.\nThis issue may also occur due to a race condition in your initialization logic.");let a=s?.message;e||(e=""),isString(e)||(t=e.values||t,a=e.message,e=e.id);const i=this.messages[e],l=void 0===i,n=this._missing;if(n&&l)return isFunction(n)?n(this._locale,e):n;l&&this.emit("missing",{id:e,locale:this._locale});let o=i||a||e;return isString(o)&&(this._messageCompiler?o=this._messageCompiler(o):console.warn(`Uncompiled message detected! Message:\n\n> ${o}\n\nThat means you use raw catalog or your catalog doesn't have a translation for the message and fallback was used.\nICU features such as interpolation and plurals will not work properly for that message. \n\nPlease compile your catalog first. \n`)),isString(o)&&ESCAPE_SEQUENCE_REGEX.test(o)?decodeEscapeSequences(o):isString(o)?o:interpolate(o,this._locale,this._locales)(t,s?.formats)}date(e,t){return date(this._locales||this._locale,e,t)}number(e,t){return number(this._locales||this._locale,e,t)}}function setupI18n(e={}){return new I18n(e)}const i18n=setupI18n();exports.I18n=I18n,exports.formats=formats,exports.i18n=i18n,exports.setupI18n=setupI18n;